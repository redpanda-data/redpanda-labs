= Migrate Data with Redpanda Migrator
:env-docker: true
:page-categories: Migration, Integration, Security
:description: Migrate data, schemas, and consumer offsets from a source Kafka cluster to a target Redpanda cluster using Redpanda Migrator.
:page-layout: lab
:page-topic-type: lab
:personas: streaming_developer, platform_operator, evaluator
// Learning objectives - what readers will explore
:learning-objective-1: Run Redpanda Migrator for continuous data replication between clusters
:learning-objective-2: Explore SASL authentication and ACL-based authorization for secure migration
:learning-objective-3: Observe topic and schema migration with preserved configurations
// CI Test for Redpanda Migrator Demo
// (test start {"id":"redpanda-migrator-demo", "description": "Redpanda Migrator demo CI test"})
// (step {"action":"runShell", "command": "docker compose down -v 2>/dev/null || true", "workingDirectory": "../docker-compose/redpanda-migrator-demo"})
// Set up attributes to hold the latest versions.
// For GitHub, hard-code the latest version to these values:
ifndef::env-site[]
:latest-redpanda-version: 25.3.4
:latest-console-version: 3.4.0
:latest-connect-version: 4.77.0
endif::[]
// For the docs site, use the built-in attributes that store the latest version as fetched from GitHub releases.
ifdef::env-site[]
:latest-redpanda-version: {full-version}
// All pages already have access to {latest-console-version} on the docs site.
endif::[]
ifndef::env-site[]
:imagesdir: ../../docs/modules/docker-compose/images/
endif::[]

ifdef::env-site[]
This lab demonstrates how to use xref:redpanda-connect:components:inputs:redpanda_migrator.adoc[Redpanda Migrator] to migrate data from a source Kafka-compatible cluster to a target Redpanda cluster.
endif::[]
ifndef::env-site[]
This lab demonstrates how to use https://docs.redpanda.com/redpanda-connect/components/inputs/redpanda_migrator/[Redpanda Migrator^] to migrate data from a source Kafka-compatible cluster to a target Redpanda cluster.
endif::[]

Redpanda Migrator is built on Redpanda Connect and provides continuous data replication with automatic topic creation, schema migration, and consumer offset synchronization.

== What you'll explore

In this lab, you will:

* [ ] {learning-objective-1}
* [ ] {learning-objective-2}
* [ ] {learning-objective-3}

== Architecture

This lab creates a complete migration environment:

* **Source cluster**: Simulates a Confluent Kafka cluster with SASL authentication, demo topics, and registered schemas
* **Target cluster**: Redpanda cluster with matching security configuration
* **Redpanda Migrator**: Continuously replicates data, schemas, and offsets from source to target
* **Console instances**: Web UIs for both clusters to observe the migration in real-time

The migrator automatically creates topics with matching partition counts and configurations, preserves schema IDs and versions, and migrates consumer offsets.

== Prerequisites

* https://docs.docker.com/compose/install/[Docker and Docker Compose^]
* At least 4GB RAM available
* https://www.gnu.org/software/make/[GNU Make^] (usually pre-installed on Linux/macOS)

This lab is for Linux and macOS users. If you are using Windows, you must use the Windows Subsystem for Linux (WSL) to run the commands in this lab.

== Run the lab

. Clone this repository:
+
[,bash]
----
git clone https://github.com/redpanda-data/redpanda-labs.git
----

. Change into the `docker-compose/redpanda-migrator-demo/` directory:
+
[,bash]
----
cd redpanda-labs/docker-compose/redpanda-migrator-demo
----

. (Optional) Set container versions.
+
The `docker-compose.yml` file uses default versions. To use specific versions, set these environment variables:
+
[,bash,subs="attributes+"]
----
export REDPANDA_VERSION={latest-redpanda-version}
export REDPANDA_CONSOLE_VERSION={latest-console-version}
export REDPANDA_CONNECT_VERSION={latest-connect-version}
----
+
For all available Redpanda versions, see the https://github.com/redpanda-data/redpanda/releases[GitHub releases^].

. Start the demo environment:
+
[,bash]
----
make start
----
// (step {"action":"runShell", "command": "docker compose up -d --wait", "workingDirectory": "../docker-compose/redpanda-migrator-demo", "timeout": 300000})
// (step {"action":"wait", "duration": 10000})
// (step {"action":"runShell", "command": "docker exec redpanda-source rpk cluster health", "output": "/Healthy/"})
// (step {"action":"runShell", "command": "docker exec redpanda-target rpk cluster health", "output": "/Healthy/"})
// (step {"action":"runShell", "command": "curl -s http://localhost:4195/ping", "output": "/pong/"})
+
This command starts the source and target Redpanda clusters, Redpanda Console instances, and the migrator service. See `docker-compose.yml` for port mappings and service details.

. Set up users, ACLs, topics, and schemas:
+
[,bash]
----
make setup
----
// (step {"action":"runShell", "command": "docker compose exec rpk-client /scripts/setup.sh", "workingDirectory": "../docker-compose/redpanda-migrator-demo", "timeout": 180000, "output": "/Secure Setup Complete/"})
// (step {"action":"wait", "duration": 90000})
// (step {"action":"runShell", "command": "docker exec rpk-client rpk topic list --brokers redpanda-source:9092 -X user=admin-user -X pass=admin-secret-password -X sasl.mechanism=SCRAM-SHA-256", "output": "/demo-orders/"})
// (step {"action":"runShell", "command": "curl -s -u admin-user:admin-secret-password http://localhost:28081/subjects", "output": "/demo-orders-value/"})
+
This creates users with SASL authentication, configures ACLs for secure migration, creates demo topics with various cleanup policies, and registers schemas. See `scripts/setup.sh` for detailed ACL permissions and topic configurations.

. (Optional) Verify the ACL configuration:
+
[,bash]
----
make verify-acls
----
+
This confirms that `migrator-user` has correct read-only source access and read-write target access with proper restrictions. See `scripts/verify-acls.sh` for test details.

. Start continuous data production:
+
[,bash]
----
make demo-start
----
// (step {"action":"runShell", "command": "docker exec rpk-client bash -c 'echo test | rpk topic produce demo-orders --brokers redpanda-source:9092 -X user=admin-user -X pass=admin-secret-password -X sasl.mechanism=SCRAM-SHA-256'"})
// (step {"action":"wait", "duration": 15000})
// (step {"action":"runShell", "command": "docker exec rpk-client rpk topic list --brokers redpanda-target:9092 -X user=admin-user -X pass=admin-secret-password -X sasl.mechanism=SCRAM-SHA-256", "output": "/demo-orders/"})
+
This starts a background producer that sends approximately 80 messages every 2 seconds across all demo topics.

. (Optional) View the migration in Redpanda Console:
+
Open your browser to observe the migration in real-time:
+
* Source cluster: http://localhost:8080[http://localhost:8080^]
* Target cluster: http://localhost:8081[http://localhost:8081^]
+
You can see topics, messages, and schemas being replicated from source to target.

. (Optional) Verify continuous schema syncing:
+
[,bash]
----
make verify-continuous-schema
----
+
This command registers a new schema after the migrator starts and confirms it automatically appears in the target Schema Registry within 15 seconds.

. Monitor migration lag:
+
[,bash]
----
make monitor-lag
----
+
This command displays a real-time dashboard showing lag per topic, message counts, and production status. Watch as the lag decreases to 0, indicating the migrator has caught up with the source cluster. Let it run for 30-60 seconds to observe continuous replication, then press kbd:[Ctrl+C] to exit.

. Verify data consistency:
+
Run the verification script to confirm successful migration:
+
[,bash]
----
make verify
----
+
This command checks that all topics, partitions, messages, cleanup policies, and schemas have been migrated correctly.

. Stop continuous production:
+
[,bash]
----
make demo-stop
----

. Disable Schema Registry import mode:
+
IMPORTANT: This step is required to return the target Schema Registry to normal operations.
+
The target Schema Registry must be in import mode for schema migration to work (enabled automatically by `make setup`). After migration completes, disable import mode:
+
[,bash]
----
curl -X PUT http://localhost:28081/mode \
  -H "Content-Type: application/json" \
  -u 'admin-user:admin-secret-password' \
  -d '{"mode":"READWRITE"}'
----
+
Import mode allows the migrator to register schemas with preserved IDs and versions. When migration is done, return to readwrite mode for normal operations.

== Configuration

The migrator uses the principle of least privilege with non-superuser accounts. For detailed security configuration including users, ACLs, and permissions, see:

* `scripts/setup.sh`: User creation and ACL configuration
* `config/migrator-config.yaml`: Migrator settings and Schema Registry sync
* `docker-compose.yml`: Service ports and environment variables

This lab uses single-node clusters and demo credentials for simplicity. For production migrations, use multi-node clusters with strong, randomly generated passwords stored in a secrets manager such as HashiCorp Vault or AWS Secrets Manager.

== Troubleshoot

=== Authentication errors

If you see "ILLEGAL_SASL_STATE" errors, run `make setup` to configure SASL authentication.

=== Topics not appearing in target

Check that the migrator is running:

[,bash]
----
docker compose ps migrator
curl http://localhost:4195/ping
----

Check the migrator logs:

[,bash]
----
docker compose logs migrator
----

=== Schemas not migrating

If you see "Subject is not in import mode" errors, enable import mode:

[,bash]
----
curl -X PUT http://localhost:28081/mode \
  -H "Content-Type: application/json" \
  -u 'admin-user:admin-secret-password' \
  -d '{"mode":"IMPORT"}'
----

Then restart the migrator:

[,bash]
----
docker compose restart migrator
----

== Clean up

To stop and remove all containers and data:

[,bash]
----
make clean
----

== Next steps

After running this demo:

ifndef::env-site[]
* Read the https://docs.redpanda.com/redpanda-connect/cookbooks/redpanda_migrator/[Redpanda Migrator documentation^]
* Learn about https://docs.redpanda.com/current/manage/schema-registry/[Schema Registry^] configuration
* Explore https://docs.redpanda.com/current/manage/security/authentication/[Redpanda authentication^] options
endif::[]
ifdef::env-site[]
* Read the xref:redpanda-connect:cookbooks:redpanda_migrator.adoc[Redpanda Migrator documentation]
* Learn about xref:ROOT:manage:schema-reg/schema-reg-overview.adoc[Schema Registry] configuration
* Explore xref:ROOT:manage:security/authentication.adoc[Redpanda authentication] options
endif::[]
// (step {"action":"runShell", "command": "docker compose down -v", "workingDirectory": "../docker-compose/redpanda-migrator-demo"})
// (test end)
